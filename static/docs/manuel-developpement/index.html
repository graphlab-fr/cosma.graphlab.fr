<!doctype html>
<html lang="fr">
<head>
	<meta charset=utf-8>
	<title>Cosma ‚Äî Manuel de d√©veloppement</title>

	<meta name="description" content="">
	<meta name="author" content=Arthur Perret,Guillaume Brioudes">
	<meta name="last_edit" content="Sun, 16 Jan 2022 15:10:07 GMT">

	<style>
        :root {
	--sans: "Helvetica Neue", Helvetica, sans-serif;
	--serif: "Georgia", 'Garamond', 'Time New Roman', 'Times', serif;
	--mono: Menlo, Monaco, Consolas, "Courier New", monospace;
	--code-background-color: #f5f5f5;
	--code-border-color: #ccc;
}

/* LAYOUT */

* {
	box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0 1em;
	line-height: 1.5;
  max-width: 1000px;
  margin: 0 auto;
  font-family: var(--serif);
  display: grid;
  grid-template-columns: 70% 30%;
  grid-gap: 0 1%;
  grid-template-areas: "header headernav"
                       "main   aside"
                       "footer footer";
}
header {
  grid-area: header;
}
nav.nav-lang {
  grid-area: headernav;
  font-family: var(--sans);
}
.nav-lang ul {
  display: flex;
  justify-content: space-between;
  list-style:none;
  padding: 0;
  margin-top: 1.8em;
}
main {
  grid-area: main;
  padding-bottom: 5vh;
}

/* HEADINGS */

header, h1, h2, h3, h4 {
	font-family: var(--sans);
}
h2, h3, h4 {
	line-height: 1.2;
	padding-bottom: 0.2em;
	border-bottom: 1px solid black;
  font-size: 1.2em;
}
main h2 {
	font-size: 1.3em;
	margin: 3.5rem 0 0.5rem 0;
}
main > h2:first-child {
	margin-top: 0;
}
main h3 {
  font-size: 1.2em;
  margin: 3rem 0 0.3rem 0;
}
main h4 {
  font-size: 1em;
  margin: 2.5rem 0 0 0;
}

/* LINKS */

a {
	color: #0056b3;
	text-decoration: none;
}
a:hover {
	color: #00448f;
	text-decoration: underline;
}
:target { animation: highlight 3s ease; }
@keyframes highlight {
  0% { background-color: #ffa; }
  100% { background-color: #ffffff; }
}

/* LISTS */

ul, ol {
	padding-left: 1rem;
}
dt {
  font-family: var(--sans);
  font-weight: bold;
  float: left;
  padding: 0 0.5rem 0 0;
}
dd {
  padding: 0;
  margin: 1rem 0 1rem 2rem;
}

/* MEDIA */

img {
  max-width: 100%;
}
figure {
  display: flex;
  flex-direction: column;
  align-items: center;
  border: var(--accent-color) 1px solid;
  padding: 15px 10px;
}
figcaption {
  font-size: 0.8rem;
  font-style: italic;
  padding: 1rem 0 0 0;
}

/* ADMONITIONS */

.astuce, .tip, .note, .important {
  position: relative;
  background: rgb(225, 225, 225);
  padding: 30px 10px 3px 10px;
  border-radius: 5px;
  margin: 1.5rem 0;
  font-size: 0.9rem;
}
.astuce::before,
.tip::before,
.note::before,
.important::before {
  content: attr(class);
  position: absolute;
  top: 5px;
  left: 5px;
  font-size: 12px;
  font-family: var(--mono);
}
.astuce, .tip, .note {
	background: rgb(225, 225, 225);
}
.important {
	background: rgb(239,178,178);
}

/* CODE */

code, pre {
	font-family: var(--mono);
}
code {
  display: inline-block;
  font-size: 90%;
}
p code,
ul code,
ol code,
dl code,
table code {
  background-color: var(--code-background-color);
  border: 1px solid var(--code-border-color);
  border-radius: 4px;
  padding: 0 0.2em;
}
pre {
  background-color: var(--code-background-color);
  border: 1px solid var(--code-border-color);
  border-radius: 4px;
  padding-left: 0.5em;
  margin: 1em 0;
  overflow-x: auto;
}

/* ASIDE (TOC) */

aside {
  grid-area: aside;
	position: sticky;
	height: 80vh;
	top: 2em;
	padding-left: 3em;
	font-size: 0.875em;
  font-family: var(--sans);
}
aside ul {
	list-style-type: none;
}
aside > nav > ul > li {
	position: relative;
	padding-bottom: 0.75em;
}
aside .toggle {
	cursor: pointer;
	position: absolute;
	left: -28px;
	top: -2px;
	padding: 2px 10px;
	color: #0056b3;
}

/* FOOTER */

footer {
  grid-area: footer;
}


    </style>
</head>

<body>
    <header>
	<article>
		<h1 class="title-site">Cosma ‚Äî Manuel de d√©veloppement</h1>
	</article>

</header>

<nav class="nav-lang">
	<ul>
		
		<li><a href="../en/cosma-developer-manual.html">üá¨üáß EN</a></li>
		
		<li><a href="../fr/cosma-manuel-de-developpement.html">üá´üá∑ FR</a></li>
		
		<li><a href="https://cosma.graphlab.fr">cosma.graphlab.fr ‚Ü¶</a></li>
	</ul>
</nav>

    <main>
        
        <p>Derni√®re mise √† jour : 16 janvier 2022</p>
        
        

        <p>Cette documentation est destin√©e aux d√©veloppeurs souhaitant participer ou reprendre le projet (code source) Cosma. Nous vous recommandons vivement de lire la documentation des utilisateurs pour bien saisir l'ensemble des usages en jeu dans le code source pr√©sent√© ci-dessous.</p>
<p>Cosma repose sur l'environnement de d√©veloppement NodeJS et les <strong>technologies du Web</strong> (HTML, CSS). Il est int√©gralement d√©velopp√© en JavaScript (ES2019). Une bonne connaissance de ces langages est requise pour modifier le c≈ìur de Cosma ou son interface en ligne de commande Cosma-cli.<br>
Modifier l'interface graphique n√©cessite en plus de ma√Ætriser le <em>framework</em> <a href="https://www.electronjs.org/">ElectronJS</a>.</p>
<h1 id="code-source" tabindex="-1">Code source</h1>
<p>Les principales fonctionnalit√©s de Cosma sont programm√©es dans le <a href="https://github.com/graphlab-fr/cosma-core">d√©p√¥t Cosma-core</a>.</p>
<ul>
<li>La lecture et le traitement d'un r√©pertoire de fichier Mardown¬†;</li>
<li>La g√©n√©ration de donn√©es d'un graphe (n≈ìuds et liens) format JSON ;</li>
<li>L'int√©gration des donn√©es (JSON), styles (CSS) et scripts (JavaScript) dans un <em>template</em> de fichier HTML ;</li>
</ul>
<p>Ces fonctionnalit√©s peuvent √™tre utilis√©es via deux interfaces, stock√©es dans deux autres d√©p√¥ts o√π est int√©gr√© (via <a href="https://git-scm.com/book/fr/v2/Utilitaires-Git-Sous-modules">Git modules</a>) le Cosma-core.</p>
<ul>
<li>Interface graphique (GUI), bas√©e sur le <em>framework</em> <a href="https://www.electronjs.org/">Electron,</a> stock√©e dans le d√©p√¥t <a href="https://github.com/graphlab-fr/cosma">Cosma</a></li>
<li>Interface en ligne de commande (CLI) stock√©e dans le d√©p√¥t <a href="https://github.com/graphlab-fr/cosma-cli">Cosma-cli</a></li>
</ul>
<h1 id="architecture-du-logiciel" tabindex="-1">Architecture du logiciel</h1>
<h2 id="vue-generale" tabindex="-1">Vue g√©n√©rale</h2>
<p>Cosma est principalement impl√©ment√© en JavaScript. Le logiciel repose sur deux syst√®mes distincts, le cosmographe et le cosmoscope, programm√©es dans le <a href="https://github.com/graphlab-fr/cosma-core">d√©p√¥t Cosma-core</a>.</p>
<p>Le <strong>cosmographe</strong> repose sur l'environnement Node.js. Il s'agit d'une s√©rie d'objets (<code>/cosma-core/models</code>) list√©s ci-dessous constituant l'API (interface de programmation) de Cosma. Elle permet d'appeler les principales fonctionnalit√©s comme la cr√©ation de fiche ou la g√©n√©ration de cosmoscopes. Cette API est manipul√©e par les deux interfaces que sont Cosma-Gui et Cosma-Cli pour rendre le m√™me comoscope.</p>
<ul>
<li><code>Config.js</code> : v√©rifier et actualiser le fichier de configuration ;</li>
<li><code>Record.js</code> :  g√©n√©rer des fichiers Markdown et leur ent√™te ;</li>
<li><code>Graph.js</code> : lire un r√©pertoire pour en extraire les fichiers Markdown et analyser leur contenu (Markdown, m√©tadonn√©es YAML et liens style wiki) afin de g√©n√©rer des donn√©es JSON ;</li>
<li><code>Template.js</code> : assembler HTML (<code>/cosma-core/template.njk</code> et <code>/cosma-core/icons/**.svg</code>), CSS (<code>/cosma-core/**.css</code> et depuis <code>Graph.js</code>), JavaScript (<code>/cosma-core/scripts/**.js</code> et <code>/cosma-core/libs/**.js</code>) et donn√©es JSON (depuis <code>Graph.js</code>) pour rendre un cosmoscope¬†;</li>
<li><code>Lang.js</code> : traduire les √©l√©ments d'interface depuis le fichier multilingue <code>/cosma-core/lang.yml</code>.</li>
</ul>
<p>Le <strong>cosmoscope</strong> est un fichier <code>.html</code> int√©grant les √©l√©ments list√©s ci-dessous et g√©n√©r√© via <code>Template.js</code>. Il peut √™tre rendu sur navigateur web, que ce soit Chromium pour afficher le comoscope dans l'application ElectronJS, ou un autre navigateur choisi par un utilisateur pour lire un comoscope.</p>
<ul>
<li>m√©tadonn√©es (titre, auteur, description, mots-cl√©s issus de la configuration) ;</li>
<li>styles (CSS) issus de <code>/cosma-core</code> et de la configuration (types de fiches, de liens, couleur de surbrillance‚Ä¶)</li>
<li>scripts et biblioth√®ques JavaScript (outils de visualisation et de navigation) ;</li>
<li>des index (mots-cl√©s, titre de fiche, vues) ;</li>
<li>les fiches.</li>
</ul>
<h2 id="interfaces-des-classes" tabindex="-1">Interfaces des classes</h2>
<p>L'objet <code>Config.js</code> (<code>/cosma-core/models/config.js</code>) est connect√© √† tous les autres objets de Cosma-core. Il permet de retrouver le fichier o√π est inscrite la configuration (<code>Config.getFilePath()</code>) en fonction de l'envrionnement (ElectronJS ou pas) et de le rendre (<code>Config.get()</code>).</p>
<p>En reposant sur cette premi√®re classe</p>
<h1 id="terminologie" tabindex="-1">Terminologie</h1>
<p>Les fichiers Markdown interpr√©t√©s par Cosma sont qualifi√©s ici de ¬´ fiches ¬ª plut√¥t que de ¬´ notes ¬ª, en r√©f√©rence √† la tradition de la fiche √©rudite et √† l'histoire de la documentation. L'acception documentaire de ¬´ fiche ¬ª n'a pas de traduction directe en anglais (sinon <em>index card</em>). En revanche, elle est conceptuellement proche du mot ¬´ <em>record</em> ¬ª issu du <a href="https://fr.wikipedia.org/wiki/Records_management"><em>records management</em></a>. Le code de Cosma emploie donc le mot record pour d√©signer une fiche.</p>
<h1 id="traduction" tabindex="-1">Traduction</h1>
<p>Pour ajouter une entr√©e de traduction au logiciel, il faut ajouter son code (norme <a href="https://fr.wikipedia.org/wiki/Liste_des_codes_ISO_639-1">ISO 639-1</a>) √† la variable <code>validLangages</code> de la classe Config (<code>/cosma-core/models/config</code>) tel que ci-dessous.</p>
<pre><code class="language-js">static validLangages = {
	...
	es: &quot;Espa√±ol&quot;
};
</code></pre>
<p>Vous pouvez ensuite compl√©ter le fichier <code>/cosma-core/lang.yml</code> en ajoutant ce drapeau comme dernier enfant d'une arboresence tel que ci-dessous :</p>
<pre><code class="language-yaml">dialog:
  btn:
    cancel:
      fr: Annuler
      en: Cancel
      es: Cancelar
</code></pre>
<p>Vous pouvez appeler l'objet traduit via le module <code>/cosma-core/models/lang.js</code> tel que ci-dessous. Selon le langue configur√©e par l'utilisateur, c'est l'entr√©e correspondante qui sera appel√©e.</p>
<pre><code class="language-js">const lang = require('./cosma-core/models/lang');

lang.getFor(lang.i.dialog.btn.cancel)
</code></pre>
<p>Vous pouvez √©galement ins√©rer des cha√Ænes √† compl√©ter tel que ci-dessous.</p>
<pre><code class="language-yaml">dialog:
  btn:
    file_filter:
      fr: Fichiers $1 envoy√© vers $2
      en: $1 file send to $2
      es: Archivo $1 enviado a $2
</code></pre>
<p>Pour chaque <code>$n</code>, vous pouvez ins√©rer depuis un tableau une valeur de remplacement.</p>
<pre><code class="language-js">const lang = require('../cosma-core/models/lang');

lang.getWith(
    lang.i.dialog.btn.file_filter,
    [
        fileExtension.toUpperCase(), // $1
        fileTarget // $2
    ]
)
</code></pre>

    </main>

    <aside id="toc">
	<nav class="toc" >
        <ul><li><a href="#vue-generale">Vue g√©n√©rale</a></li><li><a href="#interfaces-des-classes">Interfaces des classes</a></li></ul>
      </nav>
</aside>

    <footer>
    
    
    <p>
        Cosma is free software, under <a href="https://opensource.org/licenses/GPL-3.0">GPL-3.0-or-later</a> license.<br/>
        Cette documentation a √©t√© fabriqu√©e avec le g√©nial <a href="https://www.11ty.dev/">11ty</a>.
    </p>
    
</footer>

    <script>    
(function() {
  document.querySelectorAll('#toc > nav > ul > li').forEach( function(li) {
    if (li.children.length > 1) {
      var toggle = document.createElement('span');
      toggle.className = 'toggle';
      toggle.innerHTML = '‚ñ∏';
      toggle.onclick = function() {
        var sublist = li.getElementsByTagName('ul')[0];
        if (sublist) {
          if (sublist.style.display === 'none') {
            sublist.style.display = 'block'
            toggle.innerHTML = '‚ñæ';
          } else {
            sublist.style.display = 'none';
            toggle.innerHTML = '‚ñ∏';
          }
        }
      };
      li.appendChild(toggle);
      toggle.click();
    }
  });
})();
</script>

</body>

</html>